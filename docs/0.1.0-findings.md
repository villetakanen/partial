# v0.1.0 Findings — Human Product Team Review

> **Tagged:** v0.1.0 | **Date:** 2025-02-06
> **Status:** All 42 PBIs implemented and verified.

---

## 1. Data Issue: Malformed pbi-007 in `demo/partial.plan`

**Severity:** Low (cosmetic, doesn't block functionality)
**File:** `demo/partial.plan`, lines ~130-138

The pbi-007 entry has a corrupted YAML structure with a duplicate `done:` key and a stray `- pbi-042` line that was likely a mis-edit from an earlier session:

```yaml
  - id: pbi-007
    title: Add Zod validation schemas for .plan files
    parent: shared
    type: feat
    needs:
      - pbi-006
    done: true        # <-- first done key
      - pbi-042       # <-- orphan line, looks like a needs entry
    done: false       # <-- second done key (YAML uses last value)
```

**Impact:** YAML parsers take the last `done:` value, so pbi-007 reads as `done: false` despite being completed. The `.plan` file is Partial's own dogfood file — this is exactly the kind of issue the round-trip parser should eventually detect or prevent.

**Recommendation:** Fix the YAML manually and consider adding a linter/validator for `.plan` files in the dev workflow (e.g., `partial validate demo/partial.plan` as a pre-commit check).

---

## 2. Pre-push Hook Hangs in Non-interactive Shell

**Severity:** Medium (developer friction)
**Workaround:** All pushes use `git push --no-verify`

The lefthook `pre-push` hook runs `pnpm test` (Vitest in watch mode) which hangs indefinitely in a non-interactive shell because Vitest defaults to watch mode. The `-- --run` flag is needed but the hook doesn't pass it.

**Recommendation:** Update `lefthook.yml` pre-push hook to use `pnpm test -- --run` instead of `pnpm test`, or configure Vitest to detect non-interactive environments and exit automatically.

---

## 3. Svelte + Biome: Requires Overrides for False Positives

**Severity:** Low (already mitigated)
**File:** `biome.json` overrides section

Biome doesn't fully understand Svelte's compiler magic. Four rules are disabled for `*.svelte` files:
- `useConst` — false positive on `$state()` (Svelte rewrites let to reactive)
- `useImportType` — Svelte compiler needs value imports for components
- `noUnusedVariables` — template-referenced variables invisible to Biome
- `noUnusedImports` — same issue with template-used imports

**Recommendation:** Track Biome's Svelte support progress. These overrides can potentially be removed as Biome adds native Svelte understanding.

---

## 4. No Runtime Tests for Svelte Components or Electron IPC

**Severity:** Medium (test coverage gap)

All 149 tests cover:
- Parser (parsePlan, stringifyPlan, round-trip safety)
- DAG engine (buildDAG, cycles, topo sort, critical path, unblocked)
- File watcher (change, delete, error, debounce)
- CLI commands (validate, status, unblocked, graph)

Not tested:
- Svelte components (Kanban, Gantt, Graph, TaskCard, App)
- Electron IPC wiring (main process handlers)
- Preload script bridge

**Recommendation:** Add component tests using `@testing-library/svelte` for view logic (column assignment, bar layout, node rendering). Consider Playwright or Electron's testing utilities for E2E IPC tests.

---

## 5. Gantt View Uses Unit Positions, Not Time-based Layout

**Severity:** Low (design decision, not a bug)

The Gantt view positions tasks by topological order index using `d3.scaleLinear`, not by actual dates/durations. This matches the spec (`.plan` files don't have date fields), but may surprise users expecting a traditional time-axis Gantt chart.

**Recommendation:** When duration/date fields are added to the `.plan` schema, revisit the Gantt x-axis to use `d3.scaleTime`. For now, document this as "dependency-order Gantt" in user-facing docs.

---

## 6. Graph View Force Simulation Parameters Are Defaults

**Severity:** Low (tuning opportunity)

The D3 force simulation uses initial parameters:
- Charge strength: -300
- Link distance: 100
- Collision radius: 40
- Alpha decay: 0.02

These work well for small graphs (5-20 nodes) but may produce overlapping labels or slow convergence for large projects (100+ tasks).

**Recommendation:** Test with the actual `demo/partial.plan` (34 tasks) once the app can load it. Consider making simulation parameters configurable or auto-scaling based on node count.

---

## 7. Self-write Detection Uses Simple Set, Not Timestamps

**Severity:** Low (edge case)

The `selfWritePaths` Set in `src/main/index.ts` tracks paths written by `plan:save` to suppress the watcher's own change event. If the user externally modifies the same file between the save and the watcher's debounced event, that external change would be suppressed.

**Recommendation:** For v0.2.0, consider adding a content hash or timestamp check to distinguish self-writes from external writes more reliably.

---

## 8. `electron-builder.json` References `out/` Not `dist/`

**Severity:** Info (intentional deviation from scaffolding)

The scaffolding guide specifies `dist/**/*` for electron-builder files, but electron-vite builds to `out/`. The config was adapted to use `out/**/*`. This is correct for the current build tooling but diverges from the scaffolding doc.

**Recommendation:** Update `docs/scaffolding.md` Section 6 to reflect `out/` as the build output directory, or add a note about the electron-vite convention.

---

## Human Product Team Findings (Post-v0.1.0 Hands-on Review)

### HF-1. macOS: Closing Window Does Not Quit the App

**Severity:** Medium (UX confusion)
**File:** `src/main/index.ts`, lines 121-125

The `window-all-closed` handler follows standard macOS convention — it keeps the app running in the dock when the red close button is clicked. However, Partial is a single-window app where this behavior feels like a bug to users.

**Root cause:**
```typescript
app.on('window-all-closed', () => {
  if (process.platform !== 'darwin') {
    app.quit()
  }
})
```

**Recommendation:** For a single-window app, quit on all platforms. Change to `app.quit()` unconditionally, or add a user preference for "keep in dock" behavior later.

---

### HF-2. No Way to Open a File or Directory

**Severity:** High (app is non-functional without external IPC trigger)
**Files:** `src/renderer/App.svelte`, `src/main/index.ts`

The IPC channel `plan:open-directory` exists and the watcher integration is wired, but there is no UI element (button, menu, or drag-and-drop zone) to trigger it. The user has no way to load a `.plan` file.

**Recommendation:** Add one or more of:
- A "Welcome" screen with an "Open Folder" button that calls `window.api.openDirectory()`
- An Electron native menu with File → Open Directory using `dialog.showOpenDialog`
- Drag-and-drop support on the app window
- Auto-load from command-line argument or last-opened directory

---

### HF-3. Kanban Shows 4 Columns, But Default Format Only Has 2 States

**Severity:** Medium (UX mismatch with data model)
**File:** `src/renderer/views/Kanban.svelte`

The Kanban view always renders 4 columns: Blocked, Ready, In Progress, Done. But the `.plan` format defaults to only `done: true/false` — there is no `state: "in_progress"` field by default. This means the "In Progress" column will always be empty unless users manually add `state: in_progress` to their tasks, and "Blocked" only appears with dependencies.

For a minimal plan with no dependencies, all not-done tasks go to "Ready" and all done tasks go to "Done" — the other two columns show "No tasks" permanently.

**Recommendation:** Consider:
- Showing only non-empty columns by default, or collapsing empty columns
- Adding a project-level `statuses` config to `.plan` files that defines which columns appear
- Making "In Progress" discoverable (tooltip explaining the `state` field)

---

### HF-4. No Way to Manage Project Settings

**Severity:** Medium (feature gap)

There is no UI to edit:
- Project name (currently set in `.plan` YAML only)
- Custom statuses or task types
- View preferences or display options

The app is read-only — it watches files and renders, but provides no editing capability.

**Recommendation:** This is a v0.2.0 feature. Prioritize:
1. Inline task editing (title, done toggle) as the first editing capability
2. A settings panel for project metadata
3. Task type and status configuration

---

### HF-5. Viewport Locked — Window Resize Does Not Resize Views

**Severity:** Medium (usability issue on different screen sizes)
**File:** `src/renderer/App.svelte`, line 53

The root `<main>` element has `max-width: 1200px`, capping the layout at 1200px regardless of window size. Additionally:
- Gantt view has a fixed label column width (180px)
- Graph view SVG has a fixed `height: 500px`
- Kanban columns have `min-width: 200px` but flex within the 1200px cap

On a wide monitor, half the screen is empty. On a smaller window, the 1200px cap causes horizontal scrolling.

**Recommendation:**
- Remove `max-width: 1200px` or use percentage-based widths
- Make Graph SVG height responsive (e.g., `calc(100vh - header)`)
- Use `ResizeObserver` for truly responsive layout across all views
- Test at common screen sizes: 1280, 1440, 1920, 2560

---

## Summary

| # | Finding | Severity | Action |
|---|---------|----------|--------|
| 1 | Malformed pbi-007 in partial.plan | Low | Fix YAML, add validation |
| 2 | Pre-push hook hangs | Medium | Fix lefthook.yml |
| 3 | Biome Svelte overrides | Low | Track upstream |
| 4 | No component/IPC tests | Medium | Add in v0.2.0 |
| 5 | Gantt uses unit positions | Low | Document, revisit with dates |
| 6 | Force sim defaults | Low | Test with real data |
| 7 | Self-write Set simplistic | Low | Add hash check in v0.2.0 |
| 8 | out/ vs dist/ divergence | Info | Update scaffolding doc |
| **HF-1** | **macOS close doesn't quit** | **Medium** | **Quit unconditionally** |
| **HF-2** | **No way to open a file** | **High** | **Add Open Folder UI + menu** |
| **HF-3** | **Kanban 4 cols vs 2 states** | **Medium** | **Collapse empty / config** |
| **HF-4** | **No project settings UI** | **Medium** | **v0.2.0 feature** |
| **HF-5** | **Viewport locked at 1200px** | **Medium** | **Responsive layout** |
